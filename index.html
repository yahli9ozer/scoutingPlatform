<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scouting Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background-color: #f8f9fa; padding: 20px; }
        .dashboard-header { margin-bottom: 30px; }
        
        /* Status Badges */
        .status-v { background-color: #d1e7dd; color: #0f5132; font-weight: bold; border-radius: 4px; padding: 2px 8px; }
        .status-x { background-color: #f8d7da; color: #842029; font-weight: bold; border-radius: 4px; padding: 2px 8px; }
        .status-q { background-color: #fff3cd; color: #664d03; font-weight: bold; border-radius: 4px; padding: 2px 8px; }
        
        /* Table Styling */
        .player-row:hover { background-color: #e9ecef; cursor: pointer; }
        .tm-link { text-decoration: none; color: white; background: #002d72; padding: 5px 10px; border-radius: 4px; font-size: 0.8em; }
        .tm-link:hover { background: #001f4d; color: white; }
    </style>
</head>
<body>

    <div class="container">
        <div class="dashboard-header text-center">
            <h1>⚽ Scouting Platform</h1>
            <p class="text-muted">Upload the latest CSV export from SharePoint</p>
            <input type="file" id="uploadfile" class="form-control w-50 mx-auto" accept=".csv" />
        </div>

        <div class="row mb-4 text-center" id="stats-area" style="display:none;">
            <div class="col-md-4">
                <div class="card p-3">
                    <h3>Total Players</h3>
                    <h2 id="total-count">0</h2>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card p-3">
                    <h3>Top Targets (3+ Vs)</h3>
                    <h2 id="top-targets-count" class="text-success">0</h2>
                </div>
            </div>
        </div>

        <div class="card shadow-sm">
            <div class="card-body p-0">
                <table class="table table-hover mb-0" id="scouting-table">
                    <thead class="table-dark">
                        <tr>
                            <th>Name</th>
                            <th>Position</th>
                            <th>Scout 1</th>
                            <th>Scout 2</th>
                            <th>Scout 3</th>
                            <th>Scout 4</th>
                            <th>Data Team</th>
                            <th>Profile</th>
                        </tr>
                    </thead>
                    <tbody id="table-body">
                        </tbody>
                </table>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <script>
        document.getElementById('uploadfile').addEventListener('change', function() {
            const file = this.files[0];
            Papa.parse(file, {
                header: true, // Assumes Row 1 has headers like "Name", "Position", etc.
                skipEmptyLines: true,
                complete: function(results) {
                    renderTable(results.data);
                }
            });
        });

        function renderTable(data) {
            const tbody = document.getElementById('table-body');
            tbody.innerHTML = ''; // Clear existing data
            
            let topTargets = 0;

            data.forEach(player => {
                // Adjust these keys to match your EXACT CSV Headers
                // If your CSV has no headers, we access by index (row[0], row[1])
                const name = player['Name'] || player[0] || 'Unknown'; 
                const position = player['Position'] || player[1] || '-';
                
                // Scouts (Columns C, D, E, F)
                const s1 = player['Scout 1'] || player[2] || ''; 
                const s2 = player['Scout 2'] || player[3] || '';
                const s3 = player['Scout 3'] || player[4] || '';
                const s4 = player['Scout 4'] || player[5] || '';
                
                // Data (Column G)
                const dataRating = player['Data'] || player[6] || '';
                
                // Link (Column P - assuming it's roughly the 15th index if no header)
                const link = player['Transfermarkt'] || player[15] || '#';

                // Calculate "Score" (Just for stats)
                const vCount = [s1, s2, s3, s4].filter(x => x && x.toUpperCase() === 'V').length;
                if(vCount >= 3) topTargets++;

                const tr = document.createElement('tr');
                tr.className = 'player-row';
                tr.innerHTML = `
                    <td class="fw-bold">${name}</td>
                    <td><span class="badge bg-secondary">${position}</span></td>
                    <td>${renderBadge(s1)}</td>
                    <td>${renderBadge(s2)}</td>
                    <td>${renderBadge(s3)}</td>
                    <td>${renderBadge(s4)}</td>
                    <td>${renderBadge(dataRating)}</td>
                    <td>
                        ${link && link !== '#' ? `<a href="${link}" target="_blank" class="tm-link">Open TM</a>` : '-'}
                    </td>
                `;
                tbody.appendChild(tr);
            });

            // Update Stats
            document.getElementById('stats-area').style.display = 'flex';
            document.getElementById('total-count').innerText = data.length;
            document.getElementById('top-targets-count').innerText = topTargets;
        }

        // Helper function to turn text into badges
        function renderBadge(value) {
            if (!value) return '<span class="text-muted">-</span>';
            const v = value.toUpperCase().trim();
            if (v === 'V') return '<span class="status-v">✔ Approved</span>';
            if (v === 'X') return '<span class="status-x">✖ Rejected</span>';
            if (v === '?') return '<span class="status-q">❓ Pending</span>';
            return value; // Return raw text if it's something else
        }
    </script>
</body>
</html>
